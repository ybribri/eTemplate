"use strict";class eTemplate{constructor({openDelimiter:e="<%",closeDelimiter:t="%>",syncClass:s="et_sync",startUrl:l=""}={}){this.htmlCode=[],this.htmlType=[],this.htmlSync=[],this.cssRules=[],this.cssCode=[],this.cssType=[],this.syncCnt=0,this.templateInClass=[],this.titleCode="",this.startUrl=l,this.syncClass=s,this.openDelimiter=e,this.closeDelimiter=t,this.commentDelimiter=e+"%"}async render({syncUrl:e="",scrollTo:t={},iScope:s=""}={}){this.syncCnt=0,e=""===e?""!==this.startUrl?this.startUrl:this.currentUrl().filename:e;let l=this.currentUrl().host+e;const r=await fetch(l),i=await r.text();this.getTitle(i),this.changeTitle(this.titleCode);const n=await this.readFurther(i,s);if(this.htmlCode=n.codeList.code,this.htmlType=n.codeList.type,this.removeAllChildNodes(document.querySelector("body")),document.body.insertAdjacentHTML("afterbegin",n.htmlBlock.join("")),t!={}&&0!=Object.keys(t).length){let e=document.getElementById(t.id),s=["start","center","end"].some((e=>e==t.block));t.block=s?t.block:"center",null!==e&&document.getElementById(t.id).scrollIntoView({block:t.block})}document.body.style.display="block"}async readFurther(e,t){"body"!==t&&await this.changeCss(e);let{fileIncludedHTML:s,codeList:l}=await this.insertNestedHTML(e),r=this.insertModules(s),{types:i,codes:n}=this.seperateCode(r,"second"),c=this.makeSyncBlock(i,n);"JS"==i[0]&&(i.unshift("HTML"),n.unshift(" "),c=c.map((e=>e+1)),c.unshift(0)),l=this.insertSync(i,n,c),this.htmlSync=c,this.syncCnt=l.syncCnt;let o=this.interpret(i,n);return new Promise(((e,t)=>{e({htmlBlock:o,codeList:l})}))}sync(e){let t="",s=this.syncClass,l="";this.changeTitle(this.titleCode);const r=document.querySelectorAll(`input.${s}`);for(let e=0;e<r.length;e++){let s=r[e];if(t="",t=s.getAttribute("data-sync"),null!=t){"number"==s.type?t+="="+(s.value?`${this.escapeHtml(s.value)};`:'"";'):t+="="+(s.value?`"${this.escapeHtml(s.value)}";`:'"";');try{l=this.controlCode(t)}catch(e){return e}}}let i=this.interpretPart(this.htmlType,this.htmlCode,s);const n=document.querySelectorAll(`.${s}`);for(let e=0;e<n.length;e++){let t=n[e],l=t.classList,r=[],c=!1,o=0,h=l.length;for(let e=0;e<h;e++){let t=l[e];t.includes(`${s}_`)&&(c=!0,r=t.split("_").pop().split("+")),t.includes(`${s}Cnt`)&&(o=parseInt(t.replace(`${s}Cnt`,""),10))}if(c)for(let e=0;e<r.length;e++)"class"==r[e]?Array.isArray(i[o])?(t.classList.remove(this.templateInClass[o]),t.classList.add(i[o][e]),this.templateInClass[o]=i[o][e]):(t.classList.remove(this.templateInClass[o]),t.classList.add(i[o]),this.templateInClass[o]=i[o]):Array.isArray(i[o])?t.setAttribute(r[e],i[o][e]):t.setAttribute(r[e],i[o]);else this.removeAllChildNodes(t),t.insertAdjacentHTML("afterbegin",i[o])}"body"!=e&&this.syncCss()}syncCss(){if(0==this.cssType.length||!this.cssType.includes("JS"))return!0;let e=this.interpret(this.cssType,this.cssCode),t=this.parseCSS(e.join("")),s=0;for(let e=0;e<document.styleSheets.length;e++)if(null==document.styleSheets[e].href){s=e;break}let l=this.cssRules,r=l.length;const i=/\s+|\\n/g;let n="",c=[],o=[],h=t.length;for(let e=0;e<h;e++){let h=t[e],a=null==h.type?"":h.type,u=-1,d=0,p="";switch(a){case"keyframes":for(let e=0;e<r;e++){let t=l[e],s=h.styles.substring(0,h.styles.indexOf("{")).trim(),r=t.styles.substring(0,t.styles.indexOf("{")).trim();if("keyframes"==t.type&&s==r){u=e;break}}if(u>-1){let e=l[u].styles,t=h.styles;e.replace(i,"")!=t.replace(i,"")&&(document.styleSheets[s].deleteRule(u),document.styleSheets[s].insertRule(t,u)),o.push([u,-2,0,7])}else c.push(["rule",e,-1,-1,h.styles]);break;case"media":case"supports":d="media"==a?4:12;for(let e=0;e<r;e++){let t=l[e];if(t.type==a&&h.selector==t.selector){u=e;break}}if(u>-1)h.subStyles.forEach(((t,r)=>{p=t.selector;let i=-1,h=l[u].subStyles.length;for(let e=0;e<h;e++)if(l[u].subStyles[e].selector==p){i=e;break}if(i>-1)t.rules.forEach(((t,n)=>{let h=-1,a=l[u].subStyles[i].rules.length;for(let e=0;e<a;e++){if(l[u].subStyles[i].rules[e].key==t.key){h=e;break}}if(h>-1){let e=l[u].subStyles[i].rules[h].key,r=l[u].subStyles[i].rules[h].value,n=t.value;r!=n&&document.styleSheets[s].cssRules[u].cssRules[i].style.setProperty(e,n),o.push([u,i,h,d])}else c.push(["style",e,r,n,t.key,t.value])}));else{n="    "+t.selector+" {\n";for(let e=0;e<t.rules.length;e++)n+=`        ${t.rules[e].key}: ${t.rules[e].value};\n`;n+="    }\n",c.push(["rule",e,r,-1,n])}}));else{n=h.selector+" {\n";let t=h.subStyles.length;for(let e=0;e<t;e++){let t=h.subStyles[e];n=n+"    "+t.selector+" {\n";let s=t.rules.length;for(let e=0;e<s;e++)n+=`        ${t.rules[e].key}: ${t.rules[e].value};\n`;n+="    }\n"}n+="}\n",c.push(["rule",e,-1,-1,n])}break;case"":case"font-face":d="font-face"==a?5:1;for(let e=0;e<r;e++){let t=l[e];if(h.selector==t.selector){u=e;break}}if(u>-1){let t=h.rules.length;for(let r=0;r<t;r++){let t=h.rules[r],i=-1,a=l[u].rules.length;for(let e=0;e<a;e++){if(l[u].rules[e].key==t.key){i=e;break}}if(i>-1){let e=l[u].rules[i].key,r=l[u].rules[i].value,n=t.value;r!=n&&document.styleSheets[s].cssRules[u].style.setProperty(e,n),o.push([u,-1,i,d])}else n=`    ${t.key}: ${t.value};\n`,c.push(["style",e,-1,r,t.key,t.value])}}else{n=h.selector+" {\n";let t=h.rules.length;for(let e=0;e<t;e++)n+=`    ${h.rules[e].key}: ${h.rules[e].value};\n`;n+="}\n",c.push(["rule",e,-1,-1,n])}}}let a=0,u=0;for(let e=l.length-1;e>=0;e--){let t=0,r=l[e];switch(r.type){case"media":case"supports":t="media"==r.type?4:12,a=r.subStyles.length;for(let l=a-1;l>=0;l--){u=r.subStyles[l].rules.length;for(let i=u-1;i>=0;i--){if(this.arrayFind(o,[e,l,i,t])<0){let t=r.subStyles[l].rules[i].key;document.styleSheets[s].cssRules[e].cssRules[l].style.removeProperty(t)}}0==document.styleSheets[s].cssRules[e].cssRules[l].style.length&&document.styleSheets[s].cssRules[e].deleteRule(l)}0==document.styleSheets[s].cssRules[e].cssRules.length&&document.styleSheets[s].deleteRule(e);break;case"":case"font-face":t=""==r.type?1:5,u=r.rules.length;for(let l=u-1;l>=0;l--){if(this.arrayFind(o,[e,-1,l,t])<0){let t=r.rules[l].key;document.styleSheets[s].cssRules[e].style.removeProperty(t)}}0==document.styleSheets[s].cssRules[e].style.length&&document.styleSheets[s].deleteRule(e);break;case 7:this.arrayFind(o,[e,-2,0,7])<0&&document.styleSheets[s].deleteRule(e)}}let d=c.length;for(let e=0;e<d;e++){let[t,l,r,i,n,o=""]=c[e];"style"==t?-1==r?document.styleSheets[s].cssRules[l].style.setProperty(n,o):document.styleSheets[s].cssRules[l].cssRules[r].style.setProperty(n,o):-1==r?document.styleSheets[s].insertRule(n,l):document.styleSheets[s].cssRules[l].insertRule(n,r)}this.cssRules=JSON.parse(JSON.stringify(t))}findInclude(e){let t=[],s=[],l=[],r="",i=0,n="",c=e.indexOf("<body>"),o=e.indexOf("</body>");n=-1==c||-1==o?e:e.substring(c+6,o);let{codes:h,types:a}=this.seperateCode(n,"first"),u=a.length;for(let e=0;e<u;e++)"JS"==a[e]&&-1!=h[e].search(/include\(.*\)/g)&&(t.push(h[e]),l[i]=e,i++);return 0!=t.length&&t.forEach((e=>{e.includes("include(")&&(c=e.indexOf('include("'),-1==c?c=e.indexOf("include('")+9:c+=9,o=e.indexOf('")'),-1==o&&(o=e.indexOf("')")),r=e.substring(c,o),r="/"==r.substring(0,1)?r.substring(1):r,r="./"==r.substring(0,2)?r.substring(2):r,s.push(this.currentUrl().host+r))})),{urls:s,orders:l,codeList:h}}async insertNestedHTML(e){let t="",{urls:s,orders:l,codeList:r}=this.findInclude(e);return 0==s.length?(t=r.join(""),{fileIncludedHTML:t,codeList:r}):((await this.getTextFromFiles(s)).forEach(((e,t)=>{r[l[t]]=e})),t=r.join(""),({urls:s,orders:l,codeList:r}=this.findInclude(t)),0==s.length||({fileIncludedHTML:t,codeList:r}=await this.insertNestedHTML(t)),{fileIncludedHTML:t,codeList:r})}insertModules(e){let{types:t,codes:s}=this.seperateCode(e,"first"),l=0,r=t.length;for(let e=0;e<r;e++)if("JS"==t[e]&&s[e].includes("<%#")){let t=s[e].match(/(?<=<%#).*(?=%>)/)[0];try{s[e]=this.basicCode(t),l++}catch{s[e]='<%= "invalid module" %>',l++}}let i=s.join("");return 0!==l&&(i=this.insertModules(i)),i}seperateCode(e,t){const s=`(${this.openDelimiter}[^%].*?${this.closeDelimiter})`,l=new RegExp(s,"g");let r=e.split(l),i=[],n=r.length;for(let e=0;e<n;e++){let s=r[e],l=s.indexOf(`${this.openDelimiter}`),n=s.indexOf(`${this.closeDelimiter}`),c="";0!=l||n!=s.length-2||s.includes("closeDelimiter:")?c="HTML":(c="JS",r[e]="second"==t?s.substring(2,s.length-2).trim():s),i.push(c)}let c=i.length;if(c>1)for(let e=c-1;e>=1;e--)i[e]==i[e-1]&&"HTML"==i[e]&&(r[e-1]=r[e-1]+r[e],r.splice(e,1),i.splice(e,1));return{types:i,codes:r}}interpret(e,t){let s=[],l=0,r=this.escapeHtml(this.commentDelimiter.replace(this.commentDelimiter,this.openDelimiter)),i=this.escapeHtml(this.closeDelimiter),n=t.length;for(;l<n;){switch(e[l]){case"HTML":s.push(t[l].replaceAll(this.commentDelimiter,r).replaceAll(this.closeDelimiter,i));break;case"JS":if("="==t[l].substring(0,1)||"-"==t[l].substring(0,1)){try{s.push(this.basicCode(t[l]))}catch(e){s.push("invalid template")}break}{let r=this.eachBlock(e,t,l);l=r.index;try{s.push(this.controlCode(r.partBlock))}catch(e){s.push("invalid template")}break}}l++}return s}interpretPart(e,t,s){let l=[],r="",i=[],n=[],c=[],o=0,h=0,a=0,u=0,d=this.escapeHtml(this.commentDelimiter.replace(this.commentDelimiter,this.openDelimiter)),p=this.escapeHtml(this.closeDelimiter),m=t.length;for(o=0;o<m;o++)if(c.length=0,"HTML"==e[o]&&(h=0,r="",c=this.removeControlText(t[o]).split("<"),c.forEach((e=>{e.includes("class=")&&e.includes(s)&&(r=e.substring(0,e.indexOf(" ")).trim())})),r.length>0))for(a=this.htmlSync[o+1],h=o+1;h<t.length&&this.htmlSync[h]==a;h++)i.push(e[h]),n.push(t[h]);let y=n.length,f=0;for(;u<y;){switch(i[u]){case"HTML":if('="'!==n[u].substring(n[u].length-2)){l.push(n[u].replaceAll(this.commentDelimiter,d).replaceAll(this.closeDelimiter,p));break}f=1;break;case"JS":if(0==f){if("="==n[u].substring(0,1)||"-"==n[u].substring(0,1)){try{l.push(this.basicCode(n[u]))}catch(e){l.push("invalid template script")}break}{let e=this.eachBlock(i,n,u);u=e.index;try{l.push(this.controlCode(e.partBlock))}catch(e){l.push("invalid template script")}break}}if("="==n[u].substring(0,1)||"-"==n[u].substring(0,1)){try{Array.isArray(l[l.length-1])?l[l.length-1].push(this.basicCode(n[u])):l[l.length-1]=[l[l.length-1],this.basicCode(n[u])]}catch(e){l.push("invalid template script")}f=0;break}{let e=this.eachBlock(i,n,u);u=e.index;try{l.push(this.controlCode(e.partBlock))}catch(e){l.push("invalid template script")}f=0;break}}u++}return l}makeSyncBlock(e,t){let s=[],l=0,r=0,i=0,n=t.length;for(let c=0;c<n;c++){switch(e[c]){case"HTML":s.push(l);break;case"JS":if("="==t[c].substring(0,1)||"-"==t[c].substring(0,1)){s.push(l);break}r=this.findBlockEnd(e,t,c).index,i=this.findBlockEnd(e,t,c).braceBalance,i<0?console.log("ERROR: missing {"):i>0&&console.log("ERROR: missing }"),s=[...s,...Array(r-c+1).fill(l)],c=r}l++}return s}findBlockEnd(e,t,s){let l=0,r=0,i=t.length;for(r=s;r<i;r++)if(r!=s||"JS"!=e[r]){if("HTML"!=e[r]&&"JS"==e[r]&&"="!=t[r].substring(0,1)&&"-"!=t[r].substring(0,1)&&(t[r].includes("{")&&l++,t[r].includes("}")&&l--,0==l))return{index:r,error:0}}else if(t[r].includes("{")&&l++,t[r].includes("}")&&l--,0==l)return{index:r,error:0};return 0!=l?{index:s,braceBalance:l}:{index:r,braceBalance:l}}eachBlock(e,t,s){let l="",r=0,i=t.length,n=0;for(n=s;n<i;n++){if(n==s){if("JS"==e[n]){if(t[n].includes("{")&&r++,t[n].includes("}")&&r--,0==r)return{partBlock:t[n],index:n};l=`let eTemplateInterpreted=''; ${t[n]}`;continue}l=`let eTemplateInterpreted='${t[n]}';`}if("HTML"!=e[n]){if("JS"==e[n])if("="==t[n].substring(0,1)||"-"==t[n].substring(0,1))l+=`eTemplateInterpreted += ${t[n].substring(1)};`;else if(l+=t[n],t[n].includes("{")&&r++,t[n].includes("}")&&r--,0==r)return l+="; return eTemplateInterpreted;",{partBlock:l,index:n}}else l+=`eTemplateInterpreted += '${t[n]}';`}return l+="; return eTemplateInterpreted;",{partBlock:l,index:n}}insertSync(e,t,s){let l=-1,r=0,i=0,n=0,c="",o="",h="",a="",u=0,d=0,p=0,m=[],y=this.syncCnt,f=s.length;const g=this.syncClass;for(let b=0;b<f;b++)if("JS"==e[b]&&(t[b]=t[b].trim()),s[b]!=l&&"JS"==e[b]){l=s[b],d=0,p=0,u=b,d=s.lastIndexOf(s[u]),h=t[b-1],m=[];let C=this.removeControlText(h),S=C.length-C.trimEnd().length;if(">"!=C.substring(C.length-S-1).trim())if(i=h.lastIndexOf(">"),r=h.lastIndexOf("<"),i<r){c=h.substring(r),m.push(h.substring(h.lastIndexOf(" ",h.lastIndexOf('="'))+1,h.lastIndexOf('="')));for(let l=b+1;l<f;l++)if("HTML"===e[l]&&t[l].indexOf(">")>0){for(let e=b+1;e<l;e++)s[e]=s[b];d=s.lastIndexOf(s[b]);break}for(let s=b+1;s<=d;s++)"HTML"===e[s]&&t[s].includes('="')&&"JS"==e[s+1]&&m.push(t[s].substring(t[s].lastIndexOf(" ")+1,t[s].lastIndexOf("=")));let l=m.join("+");c.includes("class=")?(p=h.indexOf("class=",r)+7,t[b-1]=`${h.substring(0,p)}${g} ${g}_${l} ${g}Cnt${y} ${h.substring(p)}`,this.templateInClass[y]=this.basicCode(t[b].replace("=","")),y++):(a=t[b+1],i=a.indexOf(">"),c=a.substring(0,i),c.includes("class=")?(p=a.indexOf("class=")+7,t[b+1]=`${a.substring(0,p)}${g} ${g}_${l} ${g}Cnt${y} ${a.substring(p)}`,y++):(r=h.lastIndexOf("<"),i=h.indexOf(" ",r),t[b-1]=`${h.substring(0,i+1)} class="${g} ${g}_${l} ${g}Cnt${y}" ${h.substring(i+1)}`,y++))}else t[b-1]=t[b-1]+`<span class="${g} ${g}Cnt${y}">`,y++,t[d+1]="</span>"+t[d+1];else r=h.lastIndexOf("<"),i=h.lastIndexOf(">"),n=h.indexOf(" ",r),o=-1==n||n>i?h.substring(r+1,i):h.substring(r+1,h.length).split(" ")[0],"</"!=h.substring(r,r+2)?(console.log(b,o),console.log(t[d+1]),t[d+1].includes("</"+o)&&t[d+1].indexOf("</"+o)<(-1==t[d+1].indexOf("<"+o)?t[d+1].length:t[d+1].indexOf("<"+o))?0==this.removeControlText(t[d+1]).trim().indexOf("</"+o)?(i=h.length,r=h.lastIndexOf("<"),c=h.substring(r,i),c.includes("class=")?(p=h.indexOf("class=",r)+7,t[b-1]=`${h.substring(0,p)}${g} ${g}Cnt${y} ${h.substring(p)}`,y++):(i=h.lastIndexOf(">"),t[b-1]=`${h.substring(0,i)} class="${g} ${g}Cnt${y}" ${h.substring(i,h.length)}`,y++)):(r=0,i=t[d+1].indexOf("</"),t[b-1]=`${t[b-1]}<span class="${g} ${g}Cnt${y}">`,y++,t[d+1]=`</span>${t[d+1]}`):(t[b-1]=`${t[b-1]}<span class="${g} ${g}Cnt${y}">`,y++,t[d+1]=`</span>${t[d+1]}`)):(t[b-1]=`${t[b-1]}<span class="${g} ${g}Cnt${y}">`,y++,t[d+1]=`</span>${t[d+1]}`)}else l=s[b];return{type:e,code:t,syncCnt:y}}getTitle(e){const t=e.match(/<head>(.|[\t\n\r])*?<\/head>/g)[0].match(/<title>(.|[\t\n\r])*?<\/title>/g)[0].replace("<title>","").replace("</title>","").trim();this.titleCode=t.length>0?t:this.titleCode}changeTitle(e){const t=`${this.openDelimiter}[^%].*?${this.closeDelimiter}`,s=new RegExp(t,"g");let l=null;null!=this.titleCode.trim().match(s)&&(l=e.trim().match(s)[0].replaceAll(`${this.openDelimiter}`,"").replaceAll(`${this.closeDelimiter}`,""));let r="";null!=l&&(r=this.basicCode(l),document.head.querySelector("title").innerText=r)}async changeCss(e){let t=await this.combineCss(e),{types:s,codes:l}=this.seperateCode(t,"second");this.cssCode=l,this.cssType=s,t=this.interpret(s,l).join("");let r=this.parseCSS(t);this.cssRules=r;const i=this.createTextStyle(r);if(""==i)return;document.querySelectorAll("style").forEach((e=>{e.parentNode.removeChild(e)}));let n=document.createElement("style");n.appendChild(document.createTextNode(i)),document.head.appendChild(n),document.head.querySelectorAll("link").forEach((e=>{"stylesheet"!=e.getAttribute("rel")||e.getAttribute("href").includes("http")||e.parentNode.removeChild(e)}))}async combineCss(e){let t=[],s=[],l=e.indexOf("<head>"),r=e.indexOf("</head>");if(-1==l||-1==r)return"";e.replace(/<style>(.|[\t\n\r])*?<.style>/gi,(function(e){return s.push(e.replaceAll("<style>","").replaceAll("</style>","")),""}));let i=s.join(""),n=[];e.replace(/<link.*?(rel=("|')stylesheet("|')).*?>/gi,(function(e){return n.push(e),""}));let c=this.currentUrl().host;return n.forEach((e=>{let s=e.match(/href=".*?"/gi)[0].replaceAll("href=","").replaceAll('"',"");s.includes("http")||t.push(c+s)})),i=(await this.getTextFromFiles(t)).reduce(((e,t)=>e+t),i),i=await this.insertNestedCSS(i),i}async insertNestedCSS(e){let t="",{urls:s,orders:l,codes:r}=this.findImport(e);return 0==s.length?(t=r.join(""),t):((await this.getTextFromFiles(s)).forEach(((e,t)=>{r[l[t]]=e})),t=r.join(""),({urls:s,orders:l,codes:r}=this.findImport(t)),0!=s.length?(t=await this.insertNestedCSS(t),t):t)}findImport(e){let t=[],s=[],l=[],r="",i=0;const n=/@import[\s\S]*?["|'].*?["|'];/g;let{types:c,codes:o}=this.seperateImport(e);for(let e=0;e<c.length;e++)"IMPORT"!=c[e]||-1==o[e].search(n)||o[e].includes("http")||(t.push(o[e]),l[i]=e,i++);return 0!=t.length&&t.forEach((e=>{r=e.match(n)[0].replaceAll("@import","").replaceAll('"',"").replaceAll(";","\n").trim(),r="/"==r.substring(0,1)?r.substring(1):r,r="./"==r.substring(0,2)?r.substring(2):r,s.push(this.currentUrl().host+r)})),{urls:s,orders:l,codes:o}}seperateImport(e){let t=e.split(/(@import *["|'].*?["|'];)/g),s=[],l=t.length;for(let e=0;e<l;e++){let l=t[e],r=l.includes("@import")?"IMPORT":"OTHER";s.push(r),t[e]=l.includes("@import")?l.trim():this.removeControlText(l).trim()}return{types:s,codes:t}}createTextStyle(e){let t="",s=e.length;for(let l=0;l<s;l++){let s=e[l];switch(null==s.type?"":s.type){case"":case"font-face":t=t+s.selector+" {\n",s.rules.forEach((e=>{t+=`    ${e.key}: ${e.value};\n`})),t+="}\n";break;case"imports":case"keyframes":t=t+s.styles.replaceAll("{","{\n").replaceAll("}","}\n").replaceAll(";",";\n")+"\n";break;case"supports":case"media":t=t+s.selector+" {\n",s.subStyles.forEach((e=>{t=t+"    "+e.selector+" {\n",e.rules.forEach((e=>{t+=`        ${e.key}: ${e.value};\n`})),t+="    }\n"})),t+="}\n"}}return t}basicCode(e){try{return Function(`"use strict"; return ( ${e.substring(1)} )`)()}catch(e){return`${e.message}`}}controlCode(e){try{return Function(`"use strict"; ${e.replace(/[\n\r\t]/g,"")}`)()}catch(e){return"invalid template block"}}async renderPart(e="",t=""){let s="",l="",r="",i=[],n=[],c=[],o="",h="",a=[],u=[],d="";if(""==t.trim())return"select type from html, html_path";if(""==e.trim())return"nothing to render";switch(t){case"html":return s=e,({types:n,codes:c}=this.seperateCode(s,"second")),i=this.makeSyncBlock(n,c),"JS"==n[0]&&(n.unshift("HTML"),c.unshift(" "),i=i.map((e=>e+1)),i.unshift(0)),({types:n,codes:c,syncCnts:syncCnts}=this.insertSync(n,c,i)),this.syncCnt=syncCnts,l=this.interpret(n,c),o=l.join(""),{domText:o,sourceType:n,sourceCode:c,sourceSync:i};case"html_path":r=this.currentUrl().host+e;try{const e=await fetch(r);s=await e.text()}catch(e){return"incorrect pathname"}return({types:n,codes:c}=this.seperateCode(s,"second")),i=this.makeSyncBlock(n,c),"JS"==n[0]&&(n.unshift("HTML"),c.unshift(" "),i=i.map((e=>e+1)),i.unshift(0)),({types:n,codes:c,syncCnts:syncCnts}=this.insertSync(n,c,i)),this.syncCnt=syncCnts,l=this.interpret(n,c),o=l.join(""),{domText:o,sourceType:n,sourceCode:c,sourceSync:i};case"css":return s=e,s=await this.insertNestedCSS(s),({types:n,codes:c}=this.seperateCode(s,"second")),a=this.interpret(n,c),h=a.join(""),u=this.parseCSS(h),d=this.createTextStyle(u),{cssText:d,cssRules:u,cssType:tempCode.type,cssCode:tempCode.code};case"css_path":r=this.currentUrl().host+e;try{const e=await fetch(r);s=await e.text()}catch(e){return"incorrect pathname"}return s=await this.insertNestedCSS(s),({types:n,codes:c}=this.seperateCode(s,"second")),a=this.interpret(n,c),h=a.join(""),u=this.parseCSS(h),d=this.createTextStyle(u),{cssText:d,cssRules:u,cssType:tempCode.type,cssCode:tempCode.code}}}appendHtml(e={},t){let s=e.domText||"";if(null==t)return"no element to append to";const l=e.sourceType||[],r=e.sourceCode||[],i=e.sourceSync||[];return"DOMobject"!=this.getObjectType(t)?"invalid object to append to":0==l.length?"nothing to append":(this.htmlType=[...this.htmlType,...l],this.htmlCode=[...this.htmlCode,...r],this.htmlSync=[...this.htmlSync,...i],s=s.trim(),""==s?"nothing to append":void t.insertAdjacentHTML("beforeend",s))}appendCss(e={}){let t,s=e.cssText||"",l=e.cssRules||[],r=e.cssType||[],i=e.cssCode||[];if(null==document.querySelector("style"))return t=document.createElement("style"),t.appendChild(document.createTextNode(s)),document.head.appendChild(t),this.cssRules=[...this.cssRules,...l],this.cssType=[...this.cssType,...r],void(this.cssCode=[...this.cssCode,...i]);t=document.createTextNode(s),document.querySelector("style").appendChild(t),this.cssRules=[...this.cssRules,...l],this.cssType=[...this.cssType,...r],this.cssCode=[...this.cssCode,...i]}currentUrl(){let e=window.location.href,t=window.location.hash;e=e.replace(t,"");let s=e.split("/").pop(),l=e.substring(0,e.length-s.length);return""!=t&&(s=t.substring(1)+".html"),{host:l,filename:s}}async getTextFromFiles(e){if(0==e.length)return[];let t=e.map((e=>fetch(e))),s=await Promise.allSettled(t),l=[];s.map(((e,t)=>{e.value.ok||l.push(t)})),s=s.filter((e=>e.value.ok));let r=s.map((e=>e.value));s=await Promise.all(r);let i=s.map((e=>e.text())),n=await Promise.all(i);return l.map((e=>n.splice(e,0,"error: check your path"))),n}getObjectType(e){return("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)?"DOMobject":e.includes("<%")&&e.includes("%>")?"template":e.includes(".html")?"html_path":e.includes(".css")?"css_path":"undefined"}removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}parseCSS(e){if(void 0===e)return[];let t=/@import .*?\(.*?\);/g,s=/((@keyframes[\s\S]*?){([\s\S]*?}\s*?)})/g,l=[],r=[...(e=e.replace(/\/\*.*?\*\//g,"")).matchAll(t)],i=r.length;for(let e=0;e<i;e++){let t=r[e];l.push({selector:"@imports",type:"imports",styles:t[0]})}let n=[...(e=e.replace(t,"")).matchAll(s)],c=n.length;for(let e=0;e<c;e++){let t=n[e];l.push({selector:"@keyframes",type:"keyframes",styles:t[0]})}let o=[...(e=e.replace(s,"")).matchAll(/((\s*?(?:\/\*[\s\S]*?\*\/)?\s*?(@media|@supports)[\s\S]*?){([\s\S]*?)}\s*?})|(([\s\S]*?){([\s\S]*?)})/g)],h=o.length;for(let e=0;e<h;e++){let t=o[e],s=void 0===t[2]?t[6]:t[2];s=this.standardReturn(s);let r=s.includes("@media")?"media":s.includes("@supports")?"supports":"@font-face"===s?"font-face":"",i={selector:s,type:r};"media"===r||"supports"===r?i.subStyles=this.parseCSS(t[4]+"\n}"):i.rules=this.parseRules(t[7]),l.push(i)}return l}parseRules(e){let t=[],s=(e=this.standardReturn(e).split(";")).length;for(let l=0;l<s;l++){let s=e[l];if(s=s.trim(),s.includes(":")||"base64,"!==s.trim().substring(0,7)){if(s.includes(":")){s=s.split(":");let e=s[0].trim(),l=s.slice(1).join(":").trim();e.length>0&&l.length>0&&t.push({key:e,value:l})}}else t[t.length-1].value+=s.trim()}return t}standardReturn(e){return e.split("\r\n").join("\n").replace(/\n+/,"\n").trim()}arrayFind(e,t){let s={},l=e.length;for(let t=0;t<l;t++)s[e[t]]=t;return s.hasOwnProperty(t)?s[t]:-1}escapeHtml(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","(":"&#40;",")":"&#41;"};return e.replace(/[&<>"'()]/g,(function(e){return t[e]}))}removeControlText(e){return e.replaceAll(/\r|\n|\t/g,"")}}document.onmouseover=function(){window.innerDocClick=!0},document.onmouseleave=function(){window.innerDocClick=!1};